<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BayesianMCPMod">
<title>Analysis Example of Bayesian MCPMod for Continuous Data • BayesianMCPMod</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis Example of Bayesian MCPMod for Continuous Data">
<meta property="og:description" content="BayesianMCPMod">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BayesianMCPMod</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analysis_normal.html">Analysis Example of Bayesian MCPMod for Continuous Data</a>
    <a class="dropdown-item" href="../articles/Simulation_Example.html">Simulation Example of Bayesian MCPMod for Continuous Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Boehringer-Ingelheim/BayesianMCPMod/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analysis Example of Bayesian MCPMod for Continuous Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Boehringer-Ingelheim/BayesianMCPMod/blob/HEAD/vignettes/analysis_normal.Rmd" class="external-link"><code>vignettes/analysis_normal.Rmd</code></a></small>
      <div class="d-none name"><code>analysis_normal.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Boehringer-Ingelheim/BayesianMCPMod" class="external-link">BayesianMCPMod</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">clinDR</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: rstan</span></span>
<span><span class="co">#&gt; Loading required package: StanHeaders</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; rstan version 2.32.3 (Stan version 2.26.1)</span></span>
<span><span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt; options(mc.cores = parallel::detectCores()).</span></span>
<span><span class="co">#&gt; To avoid recompilation of unchanged Stan programs, we recommend calling</span></span>
<span><span class="co">#&gt; rstan_options(auto_write = TRUE)</span></span>
<span><span class="co">#&gt; For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span></span>
<span><span class="co">#&gt; change `threads_per_chain` option:</span></span>
<span><span class="co">#&gt; rstan_options(threads_per_chain = 1)</span></span>
<span><span class="co">#&gt; Loading required package: shiny</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7015</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background-and-data">Background and data<a class="anchor" aria-label="anchor" href="#background-and-data"></a>
</h2>
<p>In this vignette we will show the use of the Bayesian MCPMod package
for continuous distributed data. Hereby the focus is on the utilization
of an informative prior and the BayesianMCPMod evaluation of a single
trial. We will use data that is included in the clinDR package. More
specifically trial results for BRINTELLIX will be used to illustrate the
specification of an informative prior and the usage of such a prior for
the bayesian evaluation of a (hypothetical) new trial. BRINTELLIX is a
medication used to treat major depressive disorder. Various clinical
trials with different dose groups (including a control group) were
conducted.</p>
</div>
<div class="section level2">
<h2 id="calculation-of-a-map-prior">Calculation of a MAP prior<a class="anchor" aria-label="anchor" href="#calculation-of-a-map-prior"></a>
</h2>
<p>In a first step a meta analytic prior will be calculated using
historical data from 4 trials (with main endpoint Change from baseline
in MADRS score after 8 weeks). Please note that only information from
the control group will be integrated (leading to an informative mixture
prior for the control group), while for the active groups a
non-informative prior will be specified.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"metaData"</span><span class="op">)</span></span>
<span><span class="va">dataset</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">metaData</span><span class="op">)</span>, <span class="va">bname</span> <span class="op">==</span> <span class="st">"BRINTELLIX"</span><span class="op">)</span></span>
<span><span class="va">histcontrol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dataset</span>,</span>
<span>                      <span class="va">dose</span>       <span class="op">==</span> <span class="fl">0</span>,</span>
<span>                      <span class="va">primtime</span>   <span class="op">==</span> <span class="fl">8</span>,</span>
<span>                      <span class="va">indication</span> <span class="op">==</span> <span class="st">"MAJOR DEPRESSIVE DISORDER"</span>,</span>
<span>                      <span class="va">protid</span>     <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Create MAP Prior</span></span>
<span><span class="va">hist_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  trial <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">nctno</span>,</span>
<span>  est   <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">rslt</span>,</span>
<span>  se    <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">se</span>,</span>
<span>  sd    <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">sd</span>,</span>
<span>  n     <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">sampsize</span><span class="op">)</span></span></code></pre></div>
<p>Here, we suggest a function to construct a list of prior
distributions for the different dose groups. This function is adapted to
the needs of this example. Other applications may need a different way
to construct prior distributions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getPriorList</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">hist_data</span>,</span>
<span>  <span class="va">dose_levels</span>,</span>
<span>  <span class="va">dose_names</span>    <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">robust_weight</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  </span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sd_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hist_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sd</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">gmap</span> <span class="op">&lt;-</span> <span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/gMAP.html" class="external-link">gMAP</a></span><span class="op">(</span></span>
<span>    formula    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">se</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">trial</span>,</span>
<span>    weights    <span class="op">=</span> <span class="va">hist_data</span><span class="op">$</span><span class="va">n</span>,</span>
<span>    data       <span class="op">=</span> <span class="va">hist_data</span>,</span>
<span>    family     <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>    beta.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">sd_tot</span><span class="op">)</span>,</span>
<span>    tau.dist   <span class="op">=</span> <span class="st">"HalfNormal"</span>,</span>
<span>    tau.prior  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sd_tot</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">prior_ctr</span> <span class="op">&lt;-</span> <span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/automixfit.html" class="external-link">automixfit</a></span><span class="op">(</span><span class="va">gmap</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">robust_weight</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">prior_ctr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/robustify.html" class="external-link">robustify</a></span><span class="op">(</span></span>
<span>      priormix <span class="op">=</span> <span class="va">prior_ctr</span>,</span>
<span>      weight   <span class="op">=</span> <span class="va">robust_weight</span>,</span>
<span>      sigma    <span class="op">=</span> <span class="va">sd_tot</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">prior_trt</span> <span class="op">&lt;-</span> <span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span></span>
<span>    comp1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>w <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">prior_ctr</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    sigma <span class="op">=</span> <span class="va">sd_tot</span>,</span>
<span>    param <span class="op">=</span> <span class="st">"mn"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">prior_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">prior_ctr</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">prior_trt</span><span class="op">)</span>,</span>
<span>                      times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dose_levels</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">dose_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">dose_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ctr"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"DG_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">dose_levels</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prior_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dose_names</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">prior_list</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>With the dose levels to be investigated, the prior distribution can
be constructed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dose_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_list</span> <span class="op">&lt;-</span> <span class="fu">getPriorList</span><span class="op">(</span></span>
<span>  hist_data     <span class="op">=</span> <span class="va">hist_data</span>,</span>
<span>  dose_levels   <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  robust_weight <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/getESS.html">getESS</a></span><span class="op">(</span><span class="va">prior_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Ctr       DG_1       DG_2       DG_3 </span></span>
<span><span class="co">#&gt; 19.3609991  0.9999996  0.9999996  0.9999996</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specifications-new-trial">Specifications new trial<a class="anchor" aria-label="anchor" href="#specifications-new-trial"></a>
</h2>
<p>We will use the trial with ct.gov number NCT00735709 as exemplary new
trial. To be able to apply the bayesian MCPMod approach, candidate
models need to be specified. Since there are only 3 active dose levels
we will limit the set of candidate models to a linear, an exponential,
and an emax model. Note that the linear candidate model does not require
a guesstimate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_guesst</span>  <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">guesst</a></span><span class="op">(</span>d     <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                   p     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                                   model <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>                                   Maxd  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dose_levels</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emax_guesst</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">guesst</a></span><span class="op">(</span>d     <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>                                   p     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span>,</span>
<span>                                   model <span class="op">=</span> <span class="st">"emax"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/Mods.html" class="external-link">Mods</a></span><span class="op">(</span></span>
<span>  linear      <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  emax        <span class="op">=</span> <span class="va">emax_guesst</span>,</span>
<span>  exponential <span class="op">=</span> <span class="va">exp_guesst</span>,</span>
<span>  doses       <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  maxEff      <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  placEff     <span class="op">=</span> <span class="op">-</span><span class="fl">12.8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_trial</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dataset</span>,</span>
<span>                     <span class="va">primtime</span>   <span class="op">==</span> <span class="fl">8</span>,</span>
<span>                     <span class="va">indication</span> <span class="op">==</span> <span class="st">"MAJOR DEPRESSIVE DISORDER"</span>,</span>
<span>                     <span class="va">protid</span>     <span class="op">==</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">124</span>, <span class="fl">129</span>, <span class="fl">122</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combination-of-prior-information-and-trial-results">Combination of prior information and trial results<a class="anchor" aria-label="anchor" href="#combination-of-prior-information-and-trial-results"></a>
</h2>
<p>As outlined in Fleischer et al. [Bayesian MCPMod. Pharmaceutical
Statistics. 2022; 21(3): 654-670.], in a first step the posterior is
calculated combining the prior information with the estimated results of
the new trial. Via the summary function it is possible to print out the
summary information of the posterior distributions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPosterior.html">getPosterior</a></span><span class="op">(</span>prior    <span class="op">=</span> <span class="va">prior_list</span>,</span>
<span>                          mu_hat   <span class="op">=</span> <span class="va">new_trial</span><span class="op">$</span><span class="va">rslt</span>,</span>
<span>                          se_hat   <span class="op">=</span> <span class="va">new_trial</span><span class="op">$</span><span class="va">se</span>,</span>
<span>                          calc_ess <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span></span>
<span><span class="co">#&gt;           mean        sd      2.5%     50.0%      97.5%</span></span>
<span><span class="co">#&gt; Ctr  -11.20818 0.7221914 -12.58446 -11.21909  -9.772728</span></span>
<span><span class="co">#&gt; DG_1 -14.88087 0.7130817 -16.27848 -14.88087 -13.483253</span></span>
<span><span class="co">#&gt; DG_2 -15.07988 0.7101057 -16.47166 -15.07988 -13.688099</span></span>
<span><span class="co">#&gt; DG_3 -15.63631 0.7259755 -17.05920 -15.63631 -14.213428</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="execution-of-bayesian-mcpmod-test-step">Execution of Bayesian MCPMod Test step<a class="anchor" aria-label="anchor" href="#execution-of-bayesian-mcpmod-test-step"></a>
</h2>
<p>For the execution of the testing step of Bayesian MCPMod a critical
value (on the probability scale) will be determined for a given alpha
level. This critical value is calculated using (the re-estimated)
contrasts for the frequentist MCPMod to ensure that when using
non-informative priors the actual error level for falsely declaring a
significant trial in the Bayesian MCPMod is controlled (by the specified
alpha level).</p>
<p>A pseudo-optimal contrast matrix is generated based on the
variability of the posterior distribution (see Fleischer et al. 2022 for
more details). Please note that there are different possibilities how to
establish the contrasts.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crit_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCritProb.html">getCritProb</a></span><span class="op">(</span></span>
<span>    mods           <span class="op">=</span> <span class="va">mods</span>,</span>
<span>    dose_levels    <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>    se_new_trial   <span class="op">=</span> <span class="va">new_trial</span><span class="op">$</span><span class="va">se</span>,</span>
<span>    alpha_crit_val <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">contr_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getContr.html">getContr</a></span><span class="op">(</span></span>
<span> mods         <span class="op">=</span> <span class="va">mods</span>,</span>
<span> dose_levels  <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span> sd_posterior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Alternative ways to come up with a contrast would be to use </span></span>
<span><span class="co">#i) the frequentist contrast </span></span>
<span><span class="co">#contr_mat_prior &lt;- getContr(</span></span>
<span><span class="co"># mods           = mods,</span></span>
<span><span class="co"># dose_levels    = dose_levels,</span></span>
<span><span class="co"># dose_weights   = n_patients,</span></span>
<span><span class="co"># prior_list     = prior_list)</span></span>
<span><span class="co"># ii) re-estimated frequentist contrasts</span></span>
<span><span class="co"># contr_mat_prior &lt;- getContr(</span></span>
<span><span class="co"># mods           = mods,</span></span>
<span><span class="co"># dose_levels    = dose_levels,</span></span>
<span><span class="co"># se_new_trial   = new_trial$se)</span></span>
<span><span class="co"># iii)  Bayesian approach using number of patients for new trial and prior distribution  </span></span>
<span><span class="co">#contr_mat_prior &lt;- getContr(</span></span>
<span><span class="co">#  mods           = mods,</span></span>
<span><span class="co">#  dose_levels    = dose_levels,</span></span>
<span><span class="co">#  dose_weights   = n_patients,</span></span>
<span><span class="co">#  prior_list     = prior_list)</span></span></code></pre></div>
<p>The bayesian MCP testing step is then executed based on the posterior
information, the provided contrasts and the (multiplicity adjusted)
critical value.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BMCP_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/performBayesianMCP.html">performBayesianMCP</a></span><span class="op">(</span></span>
<span>  posterior_list <span class="op">=</span> <span class="va">posterior</span>,</span>
<span>  contr          <span class="op">=</span> <span class="va">contr_mat</span>, </span>
<span>  crit_prob_adj  <span class="op">=</span> <span class="va">crit_pval</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BMCP_result</span></span>
<span><span class="co">#&gt; Bayesian Multiple Comparison Procedure</span></span>
<span><span class="co">#&gt;      sign crit_prob_adj max_post_prob post_probs.linear post_probs.emax</span></span>
<span><span class="co">#&gt; [1,]    1     0.9740992     0.9999999          0.999946       0.9999999</span></span>
<span><span class="co">#&gt;      post_probs.exponential</span></span>
<span><span class="co">#&gt; [1,]              0.9977525</span></span>
<span><span class="co">#&gt; attr(,"successRate")</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; attr(,"ess_avg")</span></span>
<span><span class="co">#&gt;      Ctr     DG_1     DG_2     DG_3 </span></span>
<span><span class="co">#&gt; 182.8150 186.6163 188.1838 180.0463</span></span></code></pre></div>
<p>The testing step is significant indicating a non-flat dose-response
shape. In detail, all 3 models are significant and the p-value for the
emax model is the most significant one.</p>
</div>
<div class="section level2">
<h2 id="model-fitting-and-visualization-of-results">Model fitting and visualization of results<a class="anchor" aria-label="anchor" href="#model-fitting-and-visualization-of-results"></a>
</h2>
<p>In the model fitting step the posterior distribution is used as
basis. Both simplified and full fitting are performed. For the
simplified fit the multivariate normal distribution of the control group
is approximated and reduced by a one-dimensional normal distribution.The
actual fit (on this approximated posterior distribution) is then
performed using generalized least squares criterion. For the full
fitting the (multi-dimensional) non-linear optimization problem is
adressed via the Nelder Mead algorithm.</p>
<p>The output of the fit includes information about the predicted
effects for the included dose levels the generalized AIC (and the
corresponding weights). For the considered case the simplified and the
full fit are very similar.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Model fit</span></span>
<span><span class="va">post_observed</span> <span class="op">&lt;-</span> <span class="va">posterior</span></span>
<span><span class="va">model_shapes</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"linear"</span>, <span class="st">"emax"</span>, <span class="st">"exponential"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option a) Simplified approach by using frequentist idea</span></span>
<span><span class="va">fit_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getModelFits.html">getModelFits</a></span><span class="op">(</span></span>
<span>  models      <span class="op">=</span> <span class="va">model_shapes</span>,</span>
<span>  dose_levels <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  posterior   <span class="op">=</span> <span class="va">post_observed</span>,</span>
<span>  simple      <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option b) Making use of the complete posterior distribution</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getModelFits.html">getModelFits</a></span><span class="op">(</span></span>
<span>  models      <span class="op">=</span> <span class="va">model_shapes</span>,</span>
<span>  dose_levels <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  posterior   <span class="op">=</span> <span class="va">post_observed</span>,</span>
<span>  simple      <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Via the predict function one can also receive estimates for dose
levels that were not included in the trial.</p>
<p>It is possible to plot the fitted dose response models and an AIC
based average model (black lines). To assess the uncertainty one can in
addition visualize credible bands (orange shaded areas, the default is
set to 50% and 95%). These credible bands are calculated as follows.
Samples from the posterior distribution are drawn and for every sample
the simplified fitting step and a prediction is performed. These fits
are then used to identify and visualize the specified quantiles. The
bootstrap based quantiles can also be directly calculated and displayed
via the getbootstrapQuantiles function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, doses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $linear</span></span>
<span><span class="co">#&gt; [1] -12.45164 -13.42980 -14.01669 -14.40796 -15.19049 -16.36428</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $emax</span></span>
<span><span class="co">#&gt; [1] -11.26103 -14.80511 -15.13330 -15.25663 -15.40757 -15.52847</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $exponential</span></span>
<span><span class="co">#&gt; [1] -12.63685 -13.39493 -13.89741 -14.25396 -15.02282 -16.33036</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"doses")</span></span>
<span><span class="co">#&gt; [1]  0.0  2.5  4.0  5.0  7.0 10.0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cr_bands <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/Visualization%20and%20interpretation%20of%20the%20results-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_simple</span>, cr_bands <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/Visualization%20and%20interpretation%20of%20the%20results-2.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/getBootstrapQuantiles.html">getBootstrapQuantiles</a></span><span class="op">(</span><span class="va">fit</span>, quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, doses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    doses      models      2.5%       50%      97.5%</span></span>
<span><span class="co">#&gt; 1    0.0      linear -13.65811 -12.60508 -11.502452</span></span>
<span><span class="co">#&gt; 2    2.5      linear -14.31011 -13.51303 -12.770222</span></span>
<span><span class="co">#&gt; 3    4.0      linear -14.83490 -14.08241 -13.404869</span></span>
<span><span class="co">#&gt; 4    5.0      linear -15.18980 -14.45196 -13.786944</span></span>
<span><span class="co">#&gt; 5    7.0      linear -16.05396 -15.20380 -14.379079</span></span>
<span><span class="co">#&gt; 6   10.0      linear -17.61403 -16.30112 -15.074252</span></span>
<span><span class="co">#&gt; 7    0.0        emax -12.62223 -11.22626  -9.813453</span></span>
<span><span class="co">#&gt; 8    2.5        emax -15.76522 -14.78401 -13.526655</span></span>
<span><span class="co">#&gt; 9    4.0        emax -15.89841 -15.07748 -14.204533</span></span>
<span><span class="co">#&gt; 10   5.0        emax -16.02533 -15.23220 -14.447197</span></span>
<span><span class="co">#&gt; 11   7.0        emax -16.35580 -15.41921 -14.583929</span></span>
<span><span class="co">#&gt; 12  10.0        emax -16.79009 -15.56116 -14.636666</span></span>
<span><span class="co">#&gt; 13   0.0 exponential -13.78628 -12.80079 -11.767195</span></span>
<span><span class="co">#&gt; 14   2.5 exponential -14.32892 -13.49323 -12.730116</span></span>
<span><span class="co">#&gt; 15   4.0 exponential -14.72683 -13.97238 -13.292765</span></span>
<span><span class="co">#&gt; 16   5.0 exponential -15.06566 -14.30994 -13.649377</span></span>
<span><span class="co">#&gt; 17   7.0 exponential -15.87632 -15.04753 -14.259287</span></span>
<span><span class="co">#&gt; 18  10.0 exponential -17.59641 -16.25776 -15.026484</span></span>
<span><span class="co">#&gt; 19   0.0      avgFit -12.74349 -11.23399  -9.813453</span></span>
<span><span class="co">#&gt; 20   2.5      avgFit -15.76522 -14.77941 -13.243817</span></span>
<span><span class="co">#&gt; 21   4.0      avgFit -15.89841 -15.07683 -13.877153</span></span>
<span><span class="co">#&gt; 22   5.0      avgFit -16.02533 -15.21929 -14.261136</span></span>
<span><span class="co">#&gt; 23   7.0      avgFit -16.33707 -15.40092 -14.572745</span></span>
<span><span class="co">#&gt; 24  10.0      avgFit -16.97148 -15.59047 -14.636666</span></span></code></pre></div>
<p>Technical note: The median quantile of the bootstrap based procedure
is not necessary similar to the main model fit, as they are derived via
different procedures (main fit, i.e. black lines in the plot, show the
best fit of a certain model based on minimizing the residuals for the
posterior distribution while the bootstrap based 50% quantile indicates
the median fit of the random sampling and fitting procedure).</p>
</div>
<div class="section level2">
<h2 id="additional-notes">Additional notes<a class="anchor" aria-label="anchor" href="#additional-notes"></a>
</h2>
<p>It is also possible to perform the testing and modelling step in a
combined fashion via the performBayesianMCPMod function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overall_result</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/performBayesianMCPMod.html">performBayesianMCPMod</a></span><span class="op">(</span></span>
<span>      posterior_list   <span class="op">=</span> <span class="va">posterior</span>,</span>
<span>      contr            <span class="op">=</span> <span class="va">contr_mat</span>, </span>
<span>      crit_prob_adj    <span class="op">=</span> <span class="va">crit_pval</span>,</span>
<span>      simple           <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">overall_result</span><span class="op">$</span><span class="va">Mod</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Model Coefficients</span></span>
<span><span class="co">#&gt; linear      e0 = -12.5 delta = -0.4 </span></span>
<span><span class="co">#&gt; emax        e0 = -11.3 eMax = -4.6 ed50 = 0.7 </span></span>
<span><span class="co">#&gt; exponential e0 = -12.6 e1 = -5.7 delta = 20 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dose Levels</span></span>
<span><span class="co">#&gt;  Ctr = 0 DG_1 = 2.5 DG_2 = 5 DG_3 = 10 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Predictions, Maximum Effect, gAIC, Model Weights &amp; Significance</span></span>
<span><span class="co">#&gt;               Ctr  DG_1  DG_2  DG_3 mEff gAIC w Sign</span></span>
<span><span class="co">#&gt; linear      -12.5 -13.4 -14.4 -16.4  3.9 13.6 0 TRUE</span></span>
<span><span class="co">#&gt; emax        -11.3 -14.8 -15.3 -15.5  4.3  6.3 1 TRUE</span></span>
<span><span class="co">#&gt; exponential -12.6 -13.4 -14.3 -16.3  3.7 17.3 0 TRUE</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Boehringer Ingelheim Pharma GmbH &amp; Co. KG, Stephan Wojciekowski, Lars Andersen, Sebastian Bossert.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
