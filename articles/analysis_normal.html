<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysis Example of Bayesian MCPMod for Continuous Data • BayesianMCPMod</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis Example of Bayesian MCPMod for Continuous Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesianMCPMod</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analysis_normal.html">Analysis Example of Bayesian MCPMod for Continuous Data</a></li>
    <li><a class="dropdown-item" href="../articles/Simulation_Example.html">Simulation Example of Bayesian MCPMod for Continuous Data</a></li>
    <li><a class="dropdown-item" href="../articles/Simulation_Comparison.html">Comparison of Bayesian MCPMod and MCPMod</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Boehringer-Ingelheim/BayesianMCPMod/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="analysis_normal_files/core-js-2.5.3/shim.min.js"></script><script src="analysis_normal_files/react-18.2.0/react.min.js"></script><script src="analysis_normal_files/react-18.2.0/react-dom.min.js"></script><script src="analysis_normal_files/reactwidget-2.0.0/react-tools.js"></script><link href="analysis_normal_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="analysis_normal_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="analysis_normal_files/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="analysis_normal_files/reactable-binding-0.4.4/reactable.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analysis Example of Bayesian MCPMod for Continuous Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Boehringer-Ingelheim/BayesianMCPMod/blob/main/vignettes/analysis_normal.Rmd" class="external-link"><code>vignettes/analysis_normal.Rmd</code></a></small>
      <div class="d-none name"><code>analysis_normal.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://boehringer-ingelheim.github.io/BayesianMCPMod/">BayesianMCPMod</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://opensource.nibr.com/RBesT/" class="external-link">RBesT</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">clinDR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glin.github.io/reactable/" class="external-link">reactable</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7015</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Display Parameters Table</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function generates a markdown table displaying the names and values of parameters</span></span>
<span><span class="co">#' from a named list.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param named_list A named list where each name represents a parameter name and the list</span></span>
<span><span class="co">#'   element represents the parameter value. Date values in the list are automatically</span></span>
<span><span class="co">#'   converted to character strings for display purposes.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Prints a markdown table with two columns: "Parameter Name" and "Parameter Values".</span></span>
<span><span class="co">#'   The function does not return a value but displays the table directly to the output.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @importFrom knitr kable</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' params &lt;- list("Start Date" = as.Date("2020-01-01"),</span></span>
<span><span class="co">#'                "End Date" = as.Date("2020-12-31"),</span></span>
<span><span class="co">#'                "Threshold" = 10)</span></span>
<span><span class="co">#' display_params_table(params)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">display_params_table</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">named_list</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">display_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">value_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># dates will display as numeric by default, so convert to char first</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Date"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">named_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">value_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">value_names</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">', '</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">display_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">display_table</span>, <span class="va">values</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">round_numeric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">digits</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">display_table</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">display_table</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sublist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sublist</span>, <span class="va">round_numeric</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">display_table</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"list"</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">value_names</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">)</span>, <span class="va">display_table</span><span class="op">)</span>,</span>
<span>      col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"Value"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">named_list</span><span class="op">)</span>, <span class="va">value_names</span>, <span class="va">display_table</span><span class="op">)</span>,</span>
<span>      col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"Value Labels"</span>, <span class="st">"Value"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates the application of the {BayesianMCPMod}
package for analyzing a phase 2 dose-finding trial using the Bayesian
MCPMod approach.</p>
</div>
<div class="section level2">
<h2 id="calculation-of-a-map-prior">Calculation of a MAP prior<a class="anchor" aria-label="anchor" href="#calculation-of-a-map-prior"></a>
</h2>
<p>In a first step, a meta analytic prior will be calculated using
historical data from 4 trials with main endpoint Change from baseline in
MADRS score after 8 weeks. Please note that only information from the
control group will be integrated leading to an informative mixture prior
for the control group, while for the active groups a non-informative
prior will be specified.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"metaData"</span><span class="op">)</span></span>
<span><span class="va">dataset</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">metaData</span><span class="op">)</span>, <span class="va">bname</span> <span class="op">==</span> <span class="st">"BRINTELLIX"</span><span class="op">)</span></span>
<span><span class="va">histcontrol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">dose</span>       <span class="op">==</span> <span class="fl">0</span>,</span>
<span>  <span class="va">primtime</span>   <span class="op">==</span> <span class="fl">8</span>,</span>
<span>  <span class="va">indication</span> <span class="op">==</span> <span class="st">"MAJOR DEPRESSIVE DISORDER"</span>,</span>
<span>  <span class="va">protid</span>     <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hist_data</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  trial <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">nctno</span>,</span>
<span>  est   <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">rslt</span>,</span>
<span>  se    <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">se</span>,</span>
<span>  sd    <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">sd</span>,</span>
<span>  n     <span class="op">=</span> <span class="va">histcontrol</span><span class="op">$</span><span class="va">sampsize</span><span class="op">)</span></span></code></pre></div>
<p>Here, we suggest a function to construct a list of prior
distributions for the different dose groups. This function is adapted to
the needs of this example. Other applications may need a different way
to construct prior distributions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getPriorList</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">hist_data</span>,</span>
<span>  <span class="va">dose_levels</span>,</span>
<span>  <span class="va">dose_names</span>    <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">robust_weight</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  </span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sd_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hist_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sd</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">gmap</span> <span class="op">&lt;-</span> <span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/gMAP.html" class="external-link">gMAP</a></span><span class="op">(</span></span>
<span>    formula    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">se</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">trial</span>,</span>
<span>    weights    <span class="op">=</span> <span class="va">hist_data</span><span class="op">$</span><span class="va">n</span>,</span>
<span>    data       <span class="op">=</span> <span class="va">hist_data</span>,</span>
<span>    family     <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>    beta.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">sd_tot</span><span class="op">)</span>,</span>
<span>    tau.dist   <span class="op">=</span> <span class="st">"HalfNormal"</span>,</span>
<span>    tau.prior  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sd_tot</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">prior_ctr</span> <span class="op">&lt;-</span> <span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/automixfit.html" class="external-link">automixfit</a></span><span class="op">(</span><span class="va">gmap</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">robust_weight</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">prior_ctr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/robustify.html" class="external-link">robustify</a></span><span class="op">(</span></span>
<span>      priormix <span class="op">=</span> <span class="va">prior_ctr</span>,</span>
<span>      weight   <span class="op">=</span> <span class="va">robust_weight</span>,</span>
<span>      sigma    <span class="op">=</span> <span class="va">sd_tot</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">prior_trt</span> <span class="op">&lt;-</span> <span class="fu">RBesT</span><span class="fu">::</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span></span>
<span>    comp1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>w <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">prior_ctr</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    sigma <span class="op">=</span> <span class="va">sd_tot</span>,</span>
<span>    param <span class="op">=</span> <span class="st">"mn"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">prior_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">prior_ctr</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">prior_trt</span><span class="op">)</span>,</span>
<span>                      times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dose_levels</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">dose_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">dose_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ctr"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"DG_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">dose_levels</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prior_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dose_names</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">prior_list</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>With the dose levels to be investigated, the prior distribution can
be constructed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dose_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_list</span>  <span class="op">&lt;-</span> <span class="fu">getPriorList</span><span class="op">(</span></span>
<span>  hist_data     <span class="op">=</span> <span class="va">hist_data</span>,</span>
<span>  dose_levels   <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  robust_weight <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/getESS.html">getESS</a></span><span class="op">(</span><span class="va">prior_list</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  Ctr DG_1 DG_2 DG_3 </span></span>
<span><span class="co">## 19.7  1.0  1.0  1.0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="dose-response-model-shapes">Dose-Response Model Shapes<a class="anchor" aria-label="anchor" href="#dose-response-model-shapes"></a>
</h2>
<p>Candidate models are specified using the {DoseFinding} package.
Models can be parameterized using guesstimates or by directly providing
distribution parameters. Note that the linear candidate model does not
require parameterization.</p>
<p><span class="aside"><strong>Note:</strong> The LinLog model is rarely
used and not currently supported by
<a href="https://boehringer-ingelheim.github.io/BayesianMCPMod/">BayesianMCPMod</a>.</span></p>
<p>In the code below, the models are “guesstimated” using the
<code><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">DoseFinding::guesst</a></code> function. The <code>d</code> option
usually takes a single value (a dose level), and the corresponding
<code>p</code> for the maximum effect achieved at <code>d</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Guesstimate estimation</span></span>
<span><span class="va">exp_guesst</span>  <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">guesst</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"exponential"</span>, </span>
<span>  d <span class="op">=</span> <span class="fl">5</span>, p <span class="op">=</span> <span class="fl">0.2</span>, Maxd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dose_levels</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">emax_guesst</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">guesst</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"emax"</span>,</span>
<span>  d <span class="op">=</span> <span class="fl">2.5</span>, p <span class="op">=</span> <span class="fl">0.9</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sigEmax_guesst</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">guesst</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"sigEmax"</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">5</span><span class="op">)</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">logistic_guesst</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">guesst</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.85</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In some cases, you need to provide more information. For instance,
<code>sigEmax</code> requires a pair of <code>d</code> and
<code>p</code> values, and <code>exponential</code> requires the
specification of the maximum dose for the trial (<code>Maxd</code>).</p>
<p><span class="aside">See the help files for model specifications by
typing <code><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">?DoseFinding::guesst</a></code> in your console</span></p>
<p>Of course, you can also specify the models directly on the parameter
scale (without using <code><a href="https://rdrr.io/pkg/DoseFinding/man/guesst.html" class="external-link">DoseFinding::guesst</a></code>).</p>
<p>For example, you can get a betaMod model by specifying
<code>delta1</code> and <code>delta2</code> parameters
(<code>scale</code> is assumed to be <code>1.2</code> of the maximum
dose), or a quadratic model with the <code>delta2</code> parameter.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betaMod_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>delta1 <span class="op">=</span> <span class="fl">1</span>, delta2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">quadratic_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>delta2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can go ahead and create a <code>Mods</code> object, which
will be used in the remainder of the vignette.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/Mods.html" class="external-link">Mods</a></span><span class="op">(</span></span>
<span>  linear      <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="co"># guesstimate scale</span></span>
<span>  exponential <span class="op">=</span> <span class="va">exp_guesst</span>,</span>
<span>  emax        <span class="op">=</span> <span class="va">emax_guesst</span>,</span>
<span>  sigEmax     <span class="op">=</span> <span class="va">sigEmax_guesst</span>,</span>
<span>  logistic    <span class="op">=</span> <span class="va">logistic_guesst</span>,</span>
<span>  <span class="co"># parameter scale</span></span>
<span>  betaMod     <span class="op">=</span> <span class="va">betaMod_params</span>,</span>
<span>  quadratic   <span class="op">=</span> <span class="va">quadratic_params</span>,</span>
<span>  <span class="co"># Options for all models</span></span>
<span>  doses       <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  maxEff      <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  placEff     <span class="op">=</span> <span class="op">-</span><span class="fl">12.8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mods</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The <code>mods</code> object we just created above contains the full
model parameters, which can be helpful for understanding how the
guesstimates are translated onto the parameter scale.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">display_params_table</span><span class="op">(</span><span class="va">mods</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Name</th>
<th align="left">Value Labels</th>
<th align="left">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">linear</td>
<td align="left">e0, delta</td>
<td align="left">-12.8, -0.1</td>
</tr>
<tr class="even">
<td align="left">exponential</td>
<td align="left">e0, e1, delta</td>
<td align="left">-12.800, -0.067, 3.607</td>
</tr>
<tr class="odd">
<td align="left">emax</td>
<td align="left">e0, eMax, ed50</td>
<td align="left">-12.800, -1.028, 0.278</td>
</tr>
<tr class="even">
<td align="left">sigEmax</td>
<td align="left">e0, eMax, ed50, h</td>
<td align="left">-12.800, -1.003, 2.500, 4.248</td>
</tr>
<tr class="odd">
<td align="left">logistic</td>
<td align="left">e0, eMax, ed50, delta</td>
<td align="left">-12.797, -1.179, 7.794, 1.272</td>
</tr>
<tr class="even">
<td align="left">betaMod</td>
<td align="left">e0, eMax, delta1, delta2</td>
<td align="left">-12.8, -1.0, 1.0, 1.0</td>
</tr>
<tr class="odd">
<td align="left">quadratic</td>
<td align="left">e0, b1, b2</td>
<td align="left">-12.80, -0.40, 0.04</td>
</tr>
</tbody>
</table>
<p>And we can see the assumed treatment effects for the specified dose
groups below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DoseFinding/man/Mods.html" class="external-link">getResp</a></span><span class="op">(</span><span class="va">mods</span>, doses <span class="op">=</span> <span class="va">dose_levels</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="5%">
<col width="9%">
<col width="16%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">linear</th>
<th align="right">exponential</th>
<th align="right">emax</th>
<th align="right">sigEmax</th>
<th align="right">logistic</th>
<th align="right">betaMod</th>
<th align="right">quadratic</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">-12.80</td>
<td align="right">-12.80000</td>
<td align="right">-12.80000</td>
<td align="right">-12.80000</td>
<td align="right">-12.80000</td>
<td align="right">-12.80000</td>
<td align="right">-12.80</td>
</tr>
<tr class="even">
<td align="left">2.5</td>
<td align="right">-13.05</td>
<td align="right">-12.86667</td>
<td align="right">-13.72500</td>
<td align="right">-13.30138</td>
<td align="right">-12.81551</td>
<td align="right">-13.45972</td>
<td align="right">-13.55</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">-13.30</td>
<td align="right">-13.00000</td>
<td align="right">-13.77368</td>
<td align="right">-13.75263</td>
<td align="right">-12.91538</td>
<td align="right">-13.77222</td>
<td align="right">-13.80</td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="right">-13.80</td>
<td align="right">-13.80000</td>
<td align="right">-13.80000</td>
<td align="right">-13.80000</td>
<td align="right">-13.80000</td>
<td align="right">-13.35556</td>
<td align="right">-12.80</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="trial-data">Trial Data<a class="anchor" aria-label="anchor" href="#trial-data"></a>
</h3>
<p>We will use the trial with ct.gov number NCT00735709 as our phase 2
trial data, available in the <code>{clinDR}</code> package <span class="citation">[@nct00735709_2024a]</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"metaData"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trial_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">metaData</span><span class="op">)</span>, <span class="va">bname</span> <span class="op">==</span> <span class="st">"BRINTELLIX"</span><span class="op">)</span>,</span>
<span>  <span class="va">primtime</span> <span class="op">==</span> <span class="fl">8</span>,</span>
<span>  <span class="va">indication</span> <span class="op">==</span> <span class="st">"MAJOR DEPRESSIVE DISORDER"</span>,</span>
<span>  <span class="va">protid</span> <span class="op">==</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">124</span>, <span class="fl">129</span>, <span class="fl">122</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="posterior-calculation">Posterior Calculation<a class="anchor" aria-label="anchor" href="#posterior-calculation"></a>
</h2>
<p>In the first step of Bayesian MCPMod, the posterior is calculated by
combining the prior information with the estimated results of the trial
<span class="citation">[@fleischer_2022]</span>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPosterior.html">getPosterior</a></span><span class="op">(</span></span>
<span>  prior_list <span class="op">=</span> <span class="va">prior_list</span>,</span>
<span>  mu_hat <span class="op">=</span> <span class="va">trial_data</span><span class="op">$</span><span class="va">rslt</span>,</span>
<span>  S_hat <span class="op">=</span> <span class="va">trial_data</span><span class="op">$</span><span class="va">se</span>,</span>
<span>  calc_ess <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">50.0%</th>
<th align="right">97.5%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Ctr</td>
<td align="right">-11.19915</td>
<td align="right">0.7069568</td>
<td align="right">-12.57034</td>
<td align="right">-11.20131</td>
<td align="right">-9.807192</td>
</tr>
<tr class="even">
<td align="left">DG_1</td>
<td align="right">-14.88080</td>
<td align="right">0.7130817</td>
<td align="right">-16.27841</td>
<td align="right">-14.88080</td>
<td align="right">-13.483185</td>
</tr>
<tr class="odd">
<td align="left">DG_2</td>
<td align="right">-15.07981</td>
<td align="right">0.7101057</td>
<td align="right">-16.47159</td>
<td align="right">-15.07981</td>
<td align="right">-13.688031</td>
</tr>
<tr class="even">
<td align="left">DG_3</td>
<td align="right">-15.63624</td>
<td align="right">0.7259755</td>
<td align="right">-17.05913</td>
<td align="right">-15.63624</td>
<td align="right">-14.213356</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="bayesian-mcpmod-test-step">Bayesian MCPMod Test Step<a class="anchor" aria-label="anchor" href="#bayesian-mcpmod-test-step"></a>
</h2>
<p>The testing step of Bayesian MCPMod is executed using a critical
value on the probability scale and a pseudo-optimal contrast matrix.</p>
<p>The critical value is calculated using (re-estimated) contrasts for
frequentist MCPMod to ensure error control when using weakly-informative
priors.</p>
<p>A pseudo-optimal contrast matrix is generated based on the
variability of the posterior distribution (see <span class="citation">[@fleischer_2022]</span> for more details).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crit_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCritProb.html">getCritProb</a></span><span class="op">(</span></span>
<span>  mods           <span class="op">=</span> <span class="va">mods</span>,</span>
<span>  dose_levels    <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  se_new_trial   <span class="op">=</span> <span class="va">trial_data</span><span class="op">$</span><span class="va">se</span>,</span>
<span>  alpha_crit_val <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">contr_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getContr.html">getContr</a></span><span class="op">(</span></span>
<span>  mods         <span class="op">=</span> <span class="va">mods</span>,</span>
<span>  dose_levels  <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  sd_posterior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Please note that there are different ways to derive the contrasts.
The following code shows the implementation of some of these ways but it
is not executed and the contrast specification above is used.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># i) the frequentist contrast</span></span>
<span><span class="va">contr_mat_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getContr.html">getContr</a></span><span class="op">(</span></span>
<span>  mods           <span class="op">=</span> <span class="va">mods</span>,</span>
<span>  dose_levels    <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  dose_weights   <span class="op">=</span> <span class="va">n_patients</span>,</span>
<span>  prior_list     <span class="op">=</span> <span class="va">prior_list</span><span class="op">)</span></span>
<span><span class="co"># ii) re-estimated frequentist contrasts</span></span>
<span><span class="va">contr_mat_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getContr.html">getContr</a></span><span class="op">(</span></span>
<span>  mods           <span class="op">=</span> <span class="va">mods</span>,</span>
<span>  dose_levels    <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  se_new_trial   <span class="op">=</span> <span class="va">trial_data</span><span class="op">$</span><span class="va">se</span><span class="op">)</span></span>
<span><span class="co"># iii)  Bayesian approach using number of patients for new trial and prior distribution</span></span>
<span><span class="va">contr_mat_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getContr.html">getContr</a></span><span class="op">(</span></span>
<span>  mods           <span class="op">=</span> <span class="va">mods</span>,</span>
<span>  dose_levels    <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  dose_weights   <span class="op">=</span> <span class="va">n_patients</span>,</span>
<span>  prior_list     <span class="op">=</span> <span class="va">prior_list</span><span class="op">)</span></span></code></pre></div>
<p>The Bayesian MCP testing step is then executed:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BMCP_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/performBayesianMCP.html">performBayesianMCP</a></span><span class="op">(</span></span>
<span>  posterior_list <span class="op">=</span> <span class="va">posterior</span>,</span>
<span>  contr          <span class="op">=</span> <span class="va">contr_mat</span>, </span>
<span>  crit_prob_adj  <span class="op">=</span> <span class="va">crit_pval</span><span class="op">)</span></span></code></pre></div>
<p>Summary information:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BMCP_result</span></span></code></pre></div>
<pre><code><span><span class="co">## Bayesian Multiple Comparison Procedure</span></span>
<span><span class="co">## Summary:</span></span>
<span><span class="co">##   Sign: 1 </span></span>
<span><span class="co">##   Critical Probability: 0.9842778 </span></span>
<span><span class="co">##   Maximum Posterior Probability: 0.9999998 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Posterior Probabilities for Model Shapes:</span></span>
<span><span class="co">##        Model Probability</span></span>
<span><span class="co">##       linear   0.9999581</span></span>
<span><span class="co">##  exponential   0.9981522</span></span>
<span><span class="co">##         emax   0.9999998</span></span>
<span><span class="co">##      sigEmax   0.9999985</span></span>
<span><span class="co">##     logistic   0.9953674</span></span>
<span><span class="co">##      betaMod   0.9999930</span></span>
<span><span class="co">##    quadratic   0.9883779</span></span>
<span><span class="co">## Average Posterior ESS</span></span>
<span><span class="co">##   Ctr  DG_1  DG_2  DG_3 </span></span>
<span><span class="co">## 189.9 186.6 188.2 180.0</span></span></code></pre>
<p>The testing step is significant, indicating a non-flat dose-response
shape. All models are significant, with the <code>emax</code> model
indicating the greatest deviation from the null hypothesis.</p>
</div>
<div class="section level2">
<h2 id="model-fitting-and-visualization">Model Fitting and Visualization<a class="anchor" aria-label="anchor" href="#model-fitting-and-visualization"></a>
</h2>
<p>In the model fitting step the posterior distribution is used as
basis.</p>
<p>Both simplified and full fitting are performed.</p>
<p>For the simplified fit, the multivariate normal distribution of the
control group is approximated and reduced by a one-dimensional normal
distribution.</p>
<p>The actual fit (on this approximated posterior distribution) is then
performed using generalized least squares criterion. In contrast, for
the full fit, the non-linear optimization problem is addressed via the
Nelder-Mead algorithm <span class="citation">[@neldermead_2024a]</span>
implemented by the <a href="https://github.com/astamm/nloptr" class="external-link">nloptr</a> package.</p>
<p>The output of the fit includes information about the predicted
effects for the included dose levels, the generalized AIC, and the
corresponding weights.</p>
<p>For the considered case, the simplified and the full fit are very
similar, so we present the full fit.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If simple = TRUE, uses approx posterior</span></span>
<span><span class="co"># Here we use complete posterior distribution</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getModelFits.html">getModelFits</a></span><span class="op">(</span></span>
<span>  models      <span class="op">=</span> <span class="va">mods</span>,</span>
<span>  dose_levels <span class="op">=</span> <span class="va">dose_levels</span>,</span>
<span>  posterior   <span class="op">=</span> <span class="va">posterior</span>,</span>
<span>  simple      <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Estimates for dose levels not included in the trial:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">display_params_table</span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, doses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Name</th>
<th align="left">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">linear</td>
<td align="left">-12.403, -13.397, -13.994, -14.391, -15.187,
-16.380</td>
</tr>
<tr class="even">
<td align="left">exponential</td>
<td align="left">-12.586, -13.358, -13.870, -14.233, -15.016,
-16.348</td>
</tr>
<tr class="odd">
<td align="left">emax</td>
<td align="left">-11.244, -14.805, -15.133, -15.257, -15.407,
-15.528</td>
</tr>
<tr class="even">
<td align="left">sigEmax</td>
<td align="left">-11.243, -14.810, -15.092, -15.217, -15.394,
-15.565</td>
</tr>
<tr class="odd">
<td align="left">logistic</td>
<td align="left">-11.245, -14.837, -15.273, -15.352, -15.390,
-15.395</td>
</tr>
<tr class="even">
<td align="left">betaMod</td>
<td align="left">-11.246, -14.787, -15.099, -15.246, -15.450,
-15.556</td>
</tr>
<tr class="odd">
<td align="left">quadratic</td>
<td align="left">-11.474, -14.104, -15.165, -15.658, -16.126,
-15.535</td>
</tr>
<tr class="even">
<td align="left">avgFit</td>
<td align="left">-11.292, -14.684, -15.134, -15.315, -15.518,
-15.530</td>
</tr>
</tbody>
</table>
<p>Plots of fitted dose-response models and an AIC-based average
model:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>To assess the uncertainty, one can additionally visualize credible
bands (orange shaded areas, default levels are 50% and 95%).</p>
<p>These credible bands are calculated with a bootstrap method as
follows:</p>
<ul>
<li><p>Samples from the posterior distribution are drawn and for every
sample the simplified fitting step and a prediction is
performed.</p></li>
<li><p>These predictions are then used to identify and visualize the
specified quantiles.</p></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cr_bands <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>The bootstrap based quantiles can also be directly calculated via the
<code><a href="../reference/getBootstrapQuantiles.html">getBootstrapQuantiles()</a></code> function.</p>
<p>For this example, only 6 quantiles are bootstrapped for each model
fit.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_quantiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBootstrapQuantiles.html">getBootstrapQuantiles</a></span><span class="op">(</span></span>
<span>  model_fits <span class="op">=</span> <span class="va">fit</span>,</span>
<span>  quantiles  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  doses      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  n_samples  <span class="op">=</span> <span class="fl">6</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">reactable</span><span class="fu">::</span><span class="fu"><a href="https://glin.github.io/reactable/reference/reactable.html" class="external-link">reactable</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">bootstrap_quantiles</span>,</span>
<span>  groupBy <span class="op">=</span> <span class="st">"models"</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    doses <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colDef.html" class="external-link">colDef</a></span><span class="op">(</span>aggregate <span class="op">=</span> <span class="st">"count"</span>, format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aggregated <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colFormat.html" class="external-link">colFormat</a></span><span class="op">(</span>suffix <span class="op">=</span> <span class="st">" doses"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"2.5%"</span> <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colDef.html" class="external-link">colDef</a></span><span class="op">(</span>aggregate <span class="op">=</span> <span class="st">"mean"</span>, format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aggregated <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colFormat.html" class="external-link">colFormat</a></span><span class="op">(</span>prefix <span class="op">=</span> <span class="st">"mean = "</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, cell <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colFormat.html" class="external-link">colFormat</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"50%"</span> <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colDef.html" class="external-link">colDef</a></span><span class="op">(</span>aggregate <span class="op">=</span> <span class="st">"mean"</span>, format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aggregated <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colFormat.html" class="external-link">colFormat</a></span><span class="op">(</span>prefix <span class="op">=</span> <span class="st">"mean = "</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, cell <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colFormat.html" class="external-link">colFormat</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"97.5%"</span> <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colDef.html" class="external-link">colDef</a></span><span class="op">(</span>aggregate <span class="op">=</span> <span class="st">"mean"</span>, format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>aggregated <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colFormat.html" class="external-link">colFormat</a></span><span class="op">(</span>prefix <span class="op">=</span> <span class="st">"mean = "</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, cell <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colFormat.html" class="external-link">colFormat</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="reactable html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"doses":[0,2.5,4,5,7,10,0,2.5,4,5,7,10,0,2.5,4,5,7,10,0,2.5,4,5,7,10,0,2.5,4,5,7,10,0,2.5,4,5,7,10,0,2.5,4,5,7,10,0,2.5,4,5,7,10],"models":["linear","linear","linear","linear","linear","linear","exponential","exponential","exponential","exponential","exponential","exponential","emax","emax","emax","emax","emax","emax","sigEmax","sigEmax","sigEmax","sigEmax","sigEmax","sigEmax","logistic","logistic","logistic","logistic","logistic","logistic","betaMod","betaMod","betaMod","betaMod","betaMod","betaMod","quadratic","quadratic","quadratic","quadratic","quadratic","quadratic","avgFit","avgFit","avgFit","avgFit","avgFit","avgFit"],"2.5%":[-12.8987600091255,-13.7170567287172,-14.3170853623399,-14.7964237537268,-15.7881787896257,-17.2771075870663,-13.1048205523731,-13.7162265099188,-14.1775923755691,-14.6183117856235,-15.6123003300297,-17.3069747631322,-11.6416731799938,-15.0519897386315,-15.3344133331624,-15.550866582509,-16.0991670950034,-16.7710849560102,-11.6270465036995,-14.8798494655928,-15.5754457398374,-15.7152278274876,-16.0566694491882,-16.7956172167185,-11.6978621874408,-14.8798494656965,-15.5854248181771,-15.7526569067175,-16.2393322318676,-16.7397605460501,-11.6285938194733,-14.89671499343,-15.7514550354925,-16.1716880451265,-16.4080320920349,-16.8026462248597,-11.7402800459507,-14.5762529110546,-15.788406675516,-16.2849643070493,-16.7162985468221,-16.8045386530233,-11.646189585536,-14.8730967832037,-15.7660294265364,-16.2100378072612,-16.4540198119135,-16.7710849560102],"50%":[-12.2978195437434,-13.3305241009571,-14.0516092426011,-14.5180391418358,-15.3185859278051,-16.5142211323903,-12.5014584175372,-13.3013511582269,-13.9145597376767,-14.3561678762441,-15.134059462043,-16.4397896206514,-10.9202823032139,-14.7883487564283,-15.0960987106328,-15.3866667981041,-15.6116135986728,-15.7795152789655,-10.9195971424424,-14.7191318840764,-15.0388502737227,-15.379792911906,-15.6769439916178,-15.7785624277111,-10.9282992011266,-14.7134209482901,-15.2115732841461,-15.5589727806986,-15.6948065791955,-15.7120054518532,-10.9325995682791,-14.7186319614732,-15.0345870944529,-15.3838594163641,-15.959167371651,-15.4421502225303,-11.2903000312862,-13.9195436014136,-15.0813791563316,-15.6136584246432,-16.3488812329791,-15.4743484125352,-10.9202823032139,-14.7126596498369,-15.0960987106328,-15.4499552173286,-15.8164021260252,-15.4855813805411],"97.5%":[-12.0861424289856,-13.1043038936457,-13.5982930207673,-13.9266477344377,-14.5833571617786,-15.5684213027899,-12.3396633320667,-13.1009630408385,-13.5115768070746,-13.8013129136996,-14.4261120284161,-15.4886503690921,-10.3820708166082,-14.1547896707146,-14.8096569468348,-14.811831174205,-14.814318664009,-14.8161861451173,-10.3817001951748,-14.2053521523091,-14.8105947782697,-14.8105947782809,-14.8105947782841,-14.8105947782845,-10.3818583948437,-14.0291427540503,-14.8105947782323,-14.8105947782323,-14.8105947782323,-14.8105947782323,-10.3866179838481,-14.2072714827949,-14.9232914887433,-14.9280039084996,-14.8676464245048,-14.5906496026573,-10.6722375006769,-13.8574309440381,-14.7868524475166,-15.2272658092206,-15.614977466244,-14.5143503929904,-10.3820708166082,-14.1547896707146,-14.8096569468348,-14.811831174205,-14.814318664009,-14.8161861451173]},"columns":[{"id":"doses","name":"doses","type":"numeric","aggregate":"count","format":{"aggregated":{"suffix":" doses"}}},{"id":"models","name":"models","type":"factor"},{"id":"2.5%","name":"2.5%","type":"numeric","aggregate":"mean","format":{"aggregated":{"prefix":"mean = ","digits":2},"cell":{"digits":4}}},{"id":"50%","name":"50%","type":"numeric","aggregate":"mean","format":{"aggregated":{"prefix":"mean = ","digits":2},"cell":{"digits":4}}},{"id":"97.5%","name":"97.5%","type":"numeric","aggregate":"mean","format":{"aggregated":{"prefix":"mean = ","digits":2},"cell":{"digits":4}}}],"groupBy":["models"],"dataKey":"e846f9d3d34589ec6ecd79ac01828fbd"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script><p><strong>Technical note:</strong> The median quantile of the bootstrap
based procedure is not necessary similar to the main model fit, as they
are derived via different procedures.</p>
<p>The main fit (black line) minimizes residuals for the posterior
distribution, while the bootstrap median is the median fit of random
sampling.</p>
</div>
<div class="section level2">
<h2 id="additional-note">Additional note<a class="anchor" aria-label="anchor" href="#additional-note"></a>
</h2>
<p>Testing and modeling can also be combined via
<code><a href="../reference/performBayesianMCPMod.html">performBayesianMCPMod()</a></code>, but this is not run here.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/performBayesianMCPMod.html">performBayesianMCPMod</a></span><span class="op">(</span></span>
<span>  posterior_list   <span class="op">=</span> <span class="va">posterior</span>,</span>
<span>  contr            <span class="op">=</span> <span class="va">contr_mat</span>,</span>
<span>  crit_prob_adj    <span class="op">=</span> <span class="va">crit_pval</span>,</span>
<span>  simple           <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Boehringer Ingelheim Pharma GmbH &amp; Co. KG, Stephan Wojciekowski, Lars Andersen, Sebastian Bossert.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
